<!DOCTYPE html>
<html lang = "pl">
<head>
<meta charset = "UTF-8"/>
<title>S≈çkoban</title>
<style>
img {
float: left
}
body{
font-size: 27.5px
}
#odstep {
visibility: hidden
}
</style>
<script>
String.prototype.replaceAt = function(index, replacement) {
    return this.substr(0, index) + replacement + this.substr(index + replacement.length);
}
</script>
</head>
<body onload="poziom(1)">
<div id="ekran">wyswietl()</div>
<script type = "text/javascript">
 alert("przesuwaj skrzynki(deski) na odpowiednie pola(emerald)")
 alert("sterowanie WASD, sterowanie na telefon ju≈º nie d≈Çugo, r cofa ruch")
 var rozmiar;
 var mapa;
 var poziomka = 1;
 var box = "<img src='box.png'  width = '32px' height='32px'/>";
 var sciana = "<img src='bedrock.png' height='32px'/>";
 var podloga = "<img src='cobble.png' height='32px'/>";
 var wygrana = "<img src='win.png' height='32px'/>";
 var gracz = "<img src='https://i1.sndcdn.com/artworks-000513507990-qeqxsk-t500x500.jpg'  width = '32px' height='32px'/>";
 var pozycja_gracza;
 var ruchy = [];
 async function wyswietl()
 {
  var kopia_mapy = await mapa.replaceAt(pozycja_gracza, '^');
  kopia_mapy = await kopia_mapy.replaceAll('b', box);
  kopia_mapy = await kopia_mapy.replaceAll('B', box);
  kopia_mapy = await kopia_mapy.replaceAll('~', "<br>");
  kopia_mapy = await kopia_mapy.replaceAll('`', podloga);
  kopia_mapy = await kopia_mapy.replaceAll('^', gracz);
  kopia_mapy = await kopia_mapy.replaceAll('*', wygrana);
  kopia_mapy = await kopia_mapy.replaceAll('|', sciana);
  document.getElementById("ekran").innerHTML = await poziomka+"lvl<br>"+kopia_mapy;
 }
  
 async function zapis()
 {
	await ruchy.push(mapa);
	await ruchy.push(pozycja_gracza);
 }
 
 async function wczytaj()
 {
 if (ruchy.length > 3)
 {
 await ruchy.pop();
 await ruchy.pop();
 pozycja_gracza= await ruchy[ruchy.length - 1];
 await ruchy.pop();
 mapa = await ruchy[ruchy.length - 1];
 await ruchy.pop();
 await wyswietl();
 }
 }
 
 
 
 
 
 
 
 
 
 function zmiana_pozycji(ile)
 {
 var x = 0;
 pozycja_gracza = pozycja_gracza+ile;
 var podloga = mapa.charAt(pozycja_gracza);
 if (podloga!= '`'&&podloga!= '*'&&podloga!= 'b'&&podloga!= 'B') //sprawdza czy nie ma ≈õciamy lub pude≈Çka
	{
		pozycja_gracza= pozycja_gracza-ile;
	}
	
	
	if ((podloga== 'b'||podloga== 'B'))
		{
		x = pozycja_gracza + ile; 
		x = mapa.charAt(x); // x= miejsce za pude≈Çkiem
			if (x != "*"&& x != "`") 
			{
			pozycja_gracza= pozycja_gracza-ile;
			}
			else 
			{
			switch (podloga)
			{
			case 'b':
			mapa = mapa.replaceAt(pozycja_gracza, '`');
			x=pozycja_gracza+ile;
			if (mapa.charAt(x) == "`")
			{
			mapa = mapa.replaceAt(x, 'b');
			}else if (mapa.charAt(x) == "*")
			{
			mapa = mapa.replaceAt(x, 'B');
			}
			break;
			case 'B':
			mapa = mapa.replaceAt(pozycja_gracza, '*');
			x=pozycja_gracza+ile;
			if (mapa.charAt(x) == "`")
			{
			mapa = mapa.replaceAt(x, 'b');
			}else if (mapa.charAt(x) == "*")
			{
			mapa = mapa.replaceAt(x, 'B');
			}
			break;
			
			}
			}
		
		}
	if (!mapa.includes("*")) //sprawdza czy poziom zosta≈Ç ukonczony
	{
	poziomka = poziomka+1;
	poziom(poziomka);
	ruchy = [];
	}
	zapis();	
		
	
	
	
	
	
 }
 
 
 
 
 
 
 
 
 function gora()
 {
  var x;
	zmiana_pozycji(-rozmiar);
	wyswietl();
 }
 function dol()
 {
	zmiana_pozycji(rozmiar);
	wyswietl();
 }
 function prawo()
 {
	zmiana_pozycji(1);
	wyswietl();
 }
 function lewo()
 {
	zmiana_pozycji(-1);
	wyswietl();
 }
 
 function poziom(lvl) //zmienia poziom
 {
 switch (lvl)
 {
 case 1:
 mapa = "|||||||~|```|||~|`|b|||~|`b`**|~|||||||";
 rozmiar = 8;
 pozycja_gracza = 9;
 wyswietl();
 break;
 case 2:
 mapa = "||||```||||||||||~||||b``||||||||||~||||``b||||||||||~||``b`b`|||||||||~||`|`||`|||||||||~```|`||`|||||``**~`b``b``````````**~||||`|||`|`||``**~||||`````||||||||~";
 rozmiar = 18;
 pozycja_gracza = 136;
 wyswietl();
 break;
 case 3:
 mapa = "|||||||~|*```*|~|*bbb*|~||b`b||~|*bbb*|~|*```*|~|||||||~";
 rozmiar = 8;
 pozycja_gracza = 27;
 wyswietl();
 break;
 case 4:
 mapa = "||||||~|```||~|*bB`|~|``|`|~|````|~||||||~";
 rozmiar = 7;
 pozycja_gracza = 8;
 wyswietl();
 break;
 case 5:
 mapa = "||||||~|`*|||~|``|||~|B```|~|``b`|~|``|||~||||||~";
 rozmiar = 7;
 pozycja_gracza = 8;
 wyswietl();
 break;
 case 6:
 mapa = "||||||||~|*````*|~|BbbbbB|~|*````*|~||||||||~";
 rozmiar = 9;
 pozycja_gracza = 13;
 wyswietl();
 break;
 case 7:
 mapa = "||||||||~|``````|~|`*BBb`|~|``````|~|||||``|~||||||||~";
 rozmiar = 9;
 pozycja_gracza = 13;
 wyswietl();
 break;
 case 8:
 mapa = "||||||~|*``||~|`bb`|~||```|~|||``|~||||*|~||||||~";
 rozmiar = 7;
 pozycja_gracza = 15;
 wyswietl();
 break;
 case 9:
 mapa = "|||||||~|`````|~|`|b|`|~|*``B`|~|```|||~|||||||~";
 rozmiar = 8 ;
 pozycja_gracza = 10 ;
 wyswietl();
 break;
 case 10:
 mapa = "````````````~*```*`*`**`*~*`*`*`*`*`**~`*`*``*`*``*~````````````~";
 rozmiar = 13;
 pozycja_gracza = 1;
 wyswietl();
 alert("Dziƒôkujƒô za grƒô!")
 break;
 }

 
 
 
 
 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 document.addEventListener("keydown", function(event) {
  if (event.keyCode == 87) //w
  {
    gora();
  }
  if (event.keyCode == 65) //a
  {
    lewo();
  }
  if (event.keyCode == 83) //s
  {
    dol();
  }
  if (event.keyCode == 68) //d
  {
    prawo();
  }
  if (event.keyCode == 82) //r
  {
    wczytaj();
  }
});
  





</script>
	 <br><button type="button" onclick="poziom(poziomka)">Reset poziomu</button> <br>
	 <button type="button" onclick="wczytaj()">Cofnij ruch (R)</button><br>
	 <button type="button" id="odstep">ü°Ñ</button>
	 <button type="button" onclick="gora()">ü°Ö</button><br>
	 <button type="button" onclick="lewo()">ü°Ñ</button>
	 <button type="button" onclick="dol()">ü°á</button>
	 <button type="button" onclick="prawo()">ü°Ü</button>
	 
</body>
</html>
